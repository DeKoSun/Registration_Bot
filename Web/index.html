<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–§–ï–ù–ò–ö–° ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞</title>

  <!-- Supabase –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã -->
  <script>
    window.SUPABASE_URL = window.SUPABASE_URL || "https://ucdvtuifhmxnygibykhl.supabase.co";
    window.SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjZHZ0dWlmaG14bnlnaWJ5a2hsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MDc4MDYsImV4cCI6MjA3NTQ4MzgwNn0.G7RdjUdwwOnjnAuWi0FwjqUoWAr4vutqUN7NUMmCIgM";
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#080b10;
      --panel:#0f141b;
      --gold:#ffd166;
      --gold-2:#ffe8a3;
      --ink:#f4f6f8;
      --muted:#9aa5b1;
      --accent:#ff6a00;
      --accent-2:#ff9f43;
      --radius:20px;
      --shadow:0 10px 30px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04);
    }
    html,body{height:100%}
    *,*::before,*::after{ box-sizing:border-box }

    /* –ë–∞–∑–æ–≤—ã–π —Ñ–æ–Ω (–µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—Å—è) */
    body{
      margin:0;
      background: radial-gradient(65% 55% at 50% 40%, #0f141b, #080b10);
      color:var(--ink);
      font:500 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      overflow-x:hidden;
    }

    /* üé• –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ */
    .bg-video{
      position:fixed; inset:0;
      z-index:100;
      pointer-events:none;
      display:grid; place-items:center;
    }
    .bg-video video{
      width:100vw; height:100vh; object-fit:cover;
      filter:none;
    }
    .bg-video::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(6,8,12,.55) 0%, rgba(6,8,12,.18) 32%, rgba(6,8,12,.10) 45%, rgba(6,8,12,.35) 70%, rgba(6,8,12,.62) 100%);
    }

    /* ‚ú® –ò—Å–∫—Ä—ã */
    canvas#embers{
      position:fixed; inset:0;
      z-index:110;
      pointer-events:none;
    }

    /* –°–æ–ª–Ω–µ—á–Ω—ã–µ –≤—Å–ø–æ–ª–æ—Ö–∏ */
    .solar{
      position:fixed; inset:0; pointer-events:none;
      background:
        radial-gradient(1200px 400px at 50% -200px, rgba(255,140,20,.12), transparent 70%),
        radial-gradient(800px 320px at 20% -120px, rgba(255,200,80,.10), transparent 60%),
        radial-gradient(900px 320px at 80% -120px, rgba(255,120,40,.08), transparent 60%);
      filter: blur(6px);
      z-index:120;
    }

    .wrap{ max-width:900px; margin:0 auto; padding:24px 20px 44px; position:relative; z-index:130 }

    .card{
      position:relative; overflow:hidden; border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(20,25,35,.72), rgba(12,16,22,.88));
      border:1px solid rgba(255,255,255,.06); box-shadow:var(--shadow);
      backdrop-filter:blur(10px) saturate(120%);
    }

    .feathers{ position:absolute; inset:-8px; pointer-events:none; filter:drop-shadow(0 0 10px rgba(255,106,0,.35)); opacity:.75; z-index:0 }
    .feathers span{ position:absolute; color:rgba(255,159,67,.9); font-size:12px; animation:float 12s linear infinite; }
    .feathers span:nth-child(odd){ color:rgba(255,106,0,.95) }
    @keyframes float{ to{ transform:translateY(-35px) rotate(360deg) } }

    header.hero{ position:relative; z-index:1; padding:26px 26px 14px; text-align:center }
    h1.title{
      font-family:'Ruslan Display',serif; text-transform:uppercase; letter-spacing:.12em; font-weight:400;
      margin:6px 0 8px; font-size:52px;
      background:linear-gradient(180deg,var(--gold-2),var(--gold)); -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 0 16px rgba(255,106,0,.28), 0 0 30px rgba(255,223,144,.2);
      animation:breatheGlow 5.2s ease-in-out infinite
    }
    @keyframes breatheGlow{
      0%{   text-shadow:0 0 14px rgba(255,106,0,.2), 0 0 20px rgba(255,223,144,.12) }
      50%{  text-shadow:0 0 28px rgba(255,106,0,.45),0 0 36px rgba(255,223,144,.24) }
      100%{ text-shadow:0 0 14px rgba(255,106,0,.2), 0 0 20px rgba(255,223,144,.12) }
    }

    .subtitle{margin:8px 0 0;color:var(--muted);font-size:14px}

    /* ü•ö –Ø–π—Ü–æ —Ñ–µ–Ω–∏–∫—Å–∞ (–º–µ–∂–¥—É h1 –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–º) */
    .egg-wrap{
      display:flex; justify-content:center; align-items:center;
      margin:6px auto 6px;  /* –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∏—Ç–º */
      height:148px;         /* —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ ¬´–ø—Ä—ã–≥–∞–ª—Å—è¬ª */
    }
    .egg{
      position:relative; width:148px; height:148px; border-radius:24px;
      background:radial-gradient(circle at 50% 55%, rgba(255,210,120,.15), rgba(255,130,40,.08) 60%, transparent 65%);
      box-shadow:
        0 0 24px rgba(255,160,60,.22),
        0 0 54px rgba(255,120,30,.12),
        inset 0 0 18px rgba(255,200,120,.07);
      overflow:hidden;
    }
    .egg video,.egg img{
      width:100%; height:100%; object-fit:cover; display:block;
      filter: saturate(1.05) contrast(1.02);
    }
    .egg::after{
      content:""; position:absolute; inset:-12px;
      background: conic-gradient(from 0deg, rgba(255,160,60,.12), rgba(255,210,120,.06), transparent 40%, rgba(255,120,40,.10));
      border-radius:28px; filter:blur(18px); pointer-events:none;
      animation:eggGlow 6s ease-in-out infinite;
    }
    @keyframes eggGlow{
      0%,100%{ opacity:.55; transform:scale(1) }
      50%{ opacity:.85; transform:scale(1.02) }
    }

    form{ position:relative; z-index:1; padding:8px 18px 26px }
    .group{ margin:14px 0 12px }
    /* –∏–¥–µ–∞–ª—å–Ω—ã–π —Å—Ç—ã–∫ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è */
    #birthGroup{ margin-bottom:8px }
    .group.grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:4px;
    }

    label{display:block; font-weight:700; color:var(--gold-2); margin:0 0 10px 2px; letter-spacing:.03em; text-shadow:0 0 16px rgba(255,106,0,.25)}
    .group label:not(.chip){ font-size:17px; color:var(--gold); margin:18px 0 12px 2px }

    .input, textarea, select{
      width:100%; color:var(--ink);
      background:linear-gradient(180deg, rgba(20,24,32,.85), rgba(12,16,22,.85));
      border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px; outline:none; transition:.2s ease;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.35); font-size:15px
    }
    textarea{ min-height:84px; resize:vertical }
    .input::placeholder, textarea::placeholder{ color:#a9b4bf; font-style:normal }
    .input:focus, textarea:focus, select:focus{ border-color:rgba(255,106,0,.45); box-shadow:0 0 0 4px rgba(255,106,0,.12), inset 0 2px 6px rgba(0,0,0,.35) }

    select{ appearance:none; -webkit-appearance:none; -moz-appearance:none; padding-right:42px;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none'%3E%3Cpath d='M7 10l5 5 5-5' stroke='%23ffe8a3' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 14px center; }
    select option{ color:#0b0f14; background:#ffffff }
    select option[disabled]{ color:#8b8f99 }

    .chips{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px }
    .chip{
      position:relative; display:flex; align-items:center; gap:12px; padding:14px; border-radius:14px; width:100%; cursor:pointer;
      background:linear-gradient(180deg, rgba(20,24,32,.65), rgba(15,20,26,.9)); border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow);
    }
    .chip:hover{ transform:translateY(-1px); border-color:rgba(255,106,0,.35); box-shadow:0 6px 22px rgba(255,106,0,.18), var(--shadow) }
    .chip input{ position:absolute; inset:0; opacity:0; pointer-events:none }

    .toggler{ width:22px; height:22px; flex:0 0 22px; border-radius:8px; background:linear-gradient(180deg, rgba(20,24,32,.85), rgba(12,16,22,.85));
      border:1px solid rgba(255,255,255,.08); position:relative; box-shadow:inset 0 2px 6px rgba(0,0,0,.35) }
    .toggler::after{ content:""; position:absolute; inset:4px; border-radius:6px; background:linear-gradient(180deg, var(--accent-2), var(--accent));
      box-shadow:0 0 18px rgba(255,106,0,.45); transform:scale(0); transition:.18s ease }
    .chip input:checked + .toggler::after{ transform:scale(1) }

    .icon-img{ width:48px; height:48px; flex:0 0 48px; border-radius:12px; background-size:cover; background-position:center; box-shadow:0 2px 6px rgba(0,0,0,.35); outline:1px solid rgba(255,255,255,.08) }
    .label-inline{ color:var(--ink) }

    #daysChips{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    #daysChips .sunday{ grid-column: 1 / -1; justify-content:center; }

    .submit{
      width:100%; border:0; cursor:pointer; margin-top:12px; font-weight:900; letter-spacing:.06em; font-size:18px; text-transform:uppercase; color:#0b0f14;
      border-radius:18px; padding:20px 24px; min-height:64px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      box-shadow:0 18px 30px rgba(255,106,0,.35), inset 0 -3px 0 rgba(0,0,0,.25);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .submit:hover{ transform: translateY(-1px); box-shadow:0 26px 40px rgba(255,106,0,.45) }

    @media (max-width:520px){
      .chips{ grid-template-columns: 1fr }
      h1.title{ font-size:42px }
      .egg-wrap{ height:136px }
      .egg{ width:136px; height:136px }
      #daysChips{ grid-template-columns: 1fr }
      .group.grid-2{ grid-template-columns:1fr; }
    }

    @media (prefers-reduced-motion: reduce){
      .bg-video video{ animation:none }
    }
  </style>
</head>
<body>
  <!-- üé• –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ -->
  <div class="bg-video" aria-hidden="true">
    <video
      id="bgvid"
      preload="metadata"
      autoplay
      playsinline
      muted
      loop
      poster="icons/phoenix-bg.png">
      <source src="icons/phoenix-bg.webm" type="video/webm">
      <source src="icons/phoenix-bg.mp4" type="video/mp4">
      <img src="icons/phoenix-bg.png" alt="">
    </video>
  </div>

  <!-- –ò—Å–∫—Ä—ã -->
  <canvas id="embers"></canvas>

  <!-- –°–æ–ª–Ω–µ—á–Ω—ã–µ –≤—Å–ø–æ–ª–æ—Ö–∏ -->
  <div class="solar" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card">
      <div class="feathers" aria-hidden="true"></div>

      <header class="hero">
        <!-- —ç–º–±–ª–µ–º—É —É–±—Ä–∞–ª–∏ –ø–æ —Ç–≤–æ–µ–π –ø—Ä–æ—Å—å–±–µ -->
        <h1 class="title">–§–ï–ù–ò–ö–°</h1>

        <!-- ü•ö –Ø–π—Ü–æ —Ñ–µ–Ω–∏–∫—Å–∞ –º–µ–∂–¥—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–º -->
        <div class="egg-wrap">
          <div class="egg">
            <video id="eggvid"
              preload="metadata"
              autoplay
              muted
              playsinline
              loop
              poster="icons/egg-poster.jpg">
              <!-- üîß EGG SOURCES -->
              <source src="icons/egg.webm" type="video/webm">
              <source src="icons/egg.mp4"  type="video/mp4">
              <img src="icons/egg.gif" alt="">
            </video>
          </div>
        </div>

        <p class="subtitle">–ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É ‚Äî –ø—É—Å—Ç—å –ø–ª–∞–º—è –ø—Ä–∏–≤–µ–¥—ë—Ç —Ç–µ–±—è –≤ –∫–æ–º–∞–Ω–¥—É.</p>
      </header>

      <form id="regForm">
        <div class="group">
          <label for="nickname">–ù–∏–∫ –≤ –∏–≥—Ä–µ Doors & Treasures</label>
          <input class="input" id="nickname" name="nickname" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, DeKo_Sun" required maxlength="40" />
        </div>

        <div class="group">
          <label for="telegram">Telegram (–±–µ–∑ @)</label>
          <input class="input" id="telegram" name="telegram" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, DeKo_Soon" required pattern="^[A-Za-z0-9_]{5,}$" />
        </div>

        <div class="group" id="birthGroup">
          <label for="birthdate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
          <input class="input" id="birthdate" name="birthdate" type="date" required />
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∞ / –ì–æ—Ä–æ–¥ -->
        <div class="group grid-2">
          <div>
            <label for="country">–°—Ç—Ä–∞–Ω–∞</label>
            <input class="input" id="country" name="country" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –°–®–ê" maxlength="60" autocapitalize="off" autocomplete="country-name" />
          </div>
          <div>
            <label for="city">–ì–æ—Ä–æ–¥</label>
            <input class="input" id="city" name="city" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –ù—å—é-–ô–æ—Ä–∫" maxlength="60" autocapitalize="off" autocomplete="address-level2" />
          </div>
        </div>

        <div class="group">
          <label>–ö–∞–∫–∏–µ –¥–Ω–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å –¥–ª—è –∏–≥—Ä?</label>
          <div class="chips" id="daysChips"></div>
        </div>

        <div class="group">
          <label>–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∏–≥—Ä (–º–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è)</label>
          <div class="chips" id="timesChips"></div>
        </div>

        <div class="group">
          <label>–õ—é–±–∏–º—ã–µ –∫–æ–ª–æ–¥—ã(–∞)</label>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="decks" value="–í–∞–º–ø–∏—Ä"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Vampire.png')"></div><span class="label-inline">–í–∞–º–ø–∏—Ä</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–ö—Ç—É–ª—Ö—É"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Cthulhu.png')"></div><span class="label-inline">–ö—Ç—É–ª—Ö—É</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–ö–æ—Ç—ç"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Cat.png')"></div><span class="label-inline">–ö–æ—Ç—ç</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–°—Ç–∞–Ω–¥–∞—Ä—Ç"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Standard.png')"></div><span class="label-inline">–°—Ç–∞–Ω–¥–∞—Ä—Ç</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–û—Ä–∫"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Orc.png')"></div><span class="label-inline">–û—Ä–∫</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–£–ø—Ä—è–∂–∫–∞"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Sled.png')"></div><span class="label-inline">–£–ø—Ä—è–∂–∫–∞</span></label>
            <label class="chip"><input type="checkbox" name="decks" value="–ì–Ω–æ–º"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/Dwarf.png')"></div><span class="label-inline">–ì–Ω–æ–º</span></label>
            <!-- ¬´–ó–≤—ë–∑–¥–Ω—ã–π¬ª ‚Äî –æ—Å—Ç–∞–≤–ª—è—é —Ç–≤–æ–π –ø—É—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
            <label class="chip"><input type="checkbox" name="decks" value="–ó–≤—ë–∑–¥–Ω—ã–π"><span class="toggler"></span><div class="icon-img" style="background-image:url('icons/alien.png')"></div><span class="label-inline">–ó–≤—ë–∑–¥–Ω—ã–π</span></label>
          </div>
        </div>

        <div class="group">
          <label>–ö–∞–∫–∏–µ –∏–≥—Ä–æ–≤—ã–µ —Ä–æ–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å?</label>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="roles" value="–ê—Ç–∞–∫—É—é—â–∏–π"><span class="toggler"></span><span class="label-inline">‚öîÔ∏è –ê—Ç–∞–∫—É—é—â–∏–π</span></label>
            <label class="chip"><input type="checkbox" name="roles" value="–û–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–π"><span class="toggler"></span><span class="label-inline">üõ°Ô∏è –û–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–π</span></label>
            <label class="chip"><input type="checkbox" name="roles" value="–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"><span class="toggler"></span><span class="label-inline">üîÄ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</span></label>
            <label class="chip"><input type="checkbox" name="roles" value="–ö–∞–ø–∏—Ç–∞–Ω –ø–∞—Ä—ã"><span class="toggler"></span><span class="label-inline">üëë –ö–∞–ø–∏—Ç–∞–Ω –ø–∞—Ä—ã</span></label>
          </div>
        </div>

        <div class="group">
          <label for="experience">–û–ø—ã—Ç –≤ Doors & Treasures</label>
          <select id="experience" class="input" name="experience" required>
            <option value="" disabled selected hidden>–≤—ã–±–µ—Ä–∏‚Ä¶</option>
            <option value="–ù–æ–≤–∏—á–æ–∫ (0‚Äì100 –∏–≥—Ä)">–ù–æ–≤–∏—á–æ–∫ (0‚Äì100 –∏–≥—Ä)</option>
            <option value="–û–ø—ã—Ç–Ω—ã–π (101‚Äì1 000 –∏–≥—Ä)">–û–ø—ã—Ç–Ω—ã–π (101‚Äì1 000 –∏–≥—Ä)</option>
            <option value="–í–µ—Ç–µ—Ä–∞–Ω (1 000 –∏ –±–æ–ª–µ–µ –∏–≥—Ä)">–í–µ—Ç–µ—Ä–∞–Ω (1 000 –∏ –±–æ–ª–µ–µ –∏–≥—Ä)</option>
          </select>
        </div>

        <div class="group">
          <label>–ö–ª–∞–Ω–æ–≤–∞—è –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å</label>
          <label class="chip">
            <input type="checkbox" id="clan_life" />
            <span class="toggler" aria-hidden="true"></span>
            <span class="label-inline">–ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –∂–∏–∑–Ω–∏ –∫–ª–∞–Ω–∞</span>
          </label>
          <label class="chip" style="margin-top:8px;">
            <input type="checkbox" id="play_other" />
            <span class="toggler" aria-hidden="true"></span>
            <span class="label-inline">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –∏–≥—Ä–∞—Ç—å –≤ Alias, Codenames, –ë—É–Ω–∫–µ—Ä –∏ –¥—Ä—É–≥–∏–µ –∏–≥—Ä—ã</span>
          </label>
        </div>

        <div class="group">
          <label for="expect">–û–∂–∏–¥–∞–Ω–∏—è –æ—Ç –∫–ª–∞–Ω–∞</label>
          <textarea id="expect" name="expect" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö–æ—á—É —á–∞—â–µ –∏–≥—Ä–∞—Ç—å –≤ –≤–µ—á–µ—Ä–Ω–∏—Ö —Ç—É—Ä–Ω–∏—Ä–∞—Ö‚Ä¶"></textarea>
        </div>

        <div class="group">
          <label for="partners">–° –∫–µ–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –∏–≥—Ä–∞—Ç—å? (–Ω–∏–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –µ—Å–ª–∏ –µ—Å—Ç—å)</label>
          <input class="input" id="partners" name="partners" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, DeKo_Sun, PlayerX" />
        </div>

        <div class="group">
          <label for="conflicts">–ï—Å—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã?</label>
          <textarea id="conflicts" name="conflicts" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–±–µ–≥–∞—Ç—å –ø–∞—Ä—ã —Å PlayerY"></textarea>
        </div>

        <div class="group">
          <label class="chip"><input type="checkbox" id="notify_ok" required /><span class="toggler"></span><span class="label-inline">–°–æ–≥–ª–∞—Å–µ–Ω –ø–æ–ª—É—á–∞—Ç—å —Ç–µ–≥–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞</span></label>
          <label class="chip" style="margin-top:8px;"><input type="checkbox" id="rules_ok" required /><span class="toggler"></span><span class="label-inline">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é —á–µ—Å—Ç–Ω—É—é –∏–≥—Ä—É –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∫–ª–∞–Ω–∞</span></label>
        </div>

        <button class="submit" type="submit">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
      </form>
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø—Ä–æ—Å–º–æ—Ç—Ä (?admin=1) -->
    <div id="admin" class="card" style="display:none; margin-top:16px; padding:14px 18px 22px">
      <h2 style="margin:6px 0 14px; font-family:'Ruslan Display',serif; letter-spacing:.06em">–ê–¥–º–∏–Ω-–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
      <div style="display:grid; grid-template-columns:1fr 160px; gap:10px; margin-bottom:10px">
        <input class="input" id="search" placeholder="–ø–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É –∏–ª–∏ —Ç–µ–ª–µ–≥—Ä–∞–º" />
        <button id="reload" class="submit" style="min-height:48px; padding:12px 16px">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
      <div id="grid" style="overflow:auto; max-height:60vh; border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:8px"></div>
      <p style="color:var(--muted); font-size:12px; margin-top:8px">–ü–æ–¥–∫–ª—é—á–∏ PUBLIC –∫–ª—é—á–∏ Supabase (anon), –∏–Ω–∞—á–µ –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.</p>
    </div>
  </div>

  <script>
  (function(){
    if (window.__PHOENIX_BOOTED__) return;
    window.__PHOENIX_BOOTED__ = true;

    /* üé• –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
    (function(){
      const v = document.getElementById('bgvid');
      if(!v) return;
      const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
      function applyMotionPref(e){ if (e.matches) v.pause(); else v.play().catch(()=>{}); }
      applyMotionPref(prefersReduce);
      prefersReduce.addEventListener?.('change', applyMotionPref);
      document.addEventListener('visibilitychange', () => { if (document.hidden) v.pause(); else v.play().catch(()=>{}); });
    })();

    /* üé¨ –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —è–π—Ü–∞ —Ñ–µ–Ω–∏–∫—Å–∞ */
    (function(){
      const e = document.getElementById('eggvid');
      if(!e) return;
      const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
      function applyMotion(evn){ if (evn.matches) e.pause(); else e.play().catch(()=>{}); }
      applyMotion(prefersReduce);
      prefersReduce.addEventListener?.('change', applyMotion);
      document.addEventListener('visibilitychange', () => { if (document.hidden) e.pause(); else e.play().catch(()=>{}); });
    })();

    /* ‚ú® –ò—Å–∫—Ä—ã */
    const cvs = document.getElementById('embers');
    if (cvs) {
      const ctx = cvs.getContext('2d');
      ctx.globalCompositeOperation = 'lighter';
      let W,H,embers=[];
      const FX = { rise: 0.20, spin: 0.010 }; // —á—É—Ç–æ—á–∫—É –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª

      function resize(){ W=innerWidth; H=innerHeight; cvs.width=W; cvs.height=H; make(); }
      function make(){
        const count = Math.min(260, Math.floor(W*H/6500));
        embers=Array.from({length:count}, () => ({
          x:Math.random()*W, y:Math.random()*H,
          r:Math.random()*1.5+.25, s:Math.random()*.6+.25, a:Math.random()*Math.PI*2
        }));
      }
      function draw(){
        ctx.clearRect(0,0,W,H);
        for(const p of embers){
          p.a += FX.spin;
          const t=(Math.sin(p.a)+1)/2;
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r+t*.7,0,Math.PI*2);
          ctx.fillStyle=`rgba(255,${120+(t*90|0)},0,${.28+t*.25})`;
          ctx.fill();
          p.y -= (p.s)*FX.rise;
          if(p.y<-6){ p.y=H+6; p.x=Math.random()*W; }
        }
        requestAnimationFrame(draw);
      }
      resize(); draw(); addEventListener('resize', resize);
    }

    /* –î–µ–∫–æ—Ä –≤ –∫–∞—Ä—Ç–æ—á–∫–µ */
    (function(){
      const box=document.querySelector('.feathers'); if(!box) return;
      const glyphs='~ ‚àø „Ä∞  ‚âà  ‚àº  Àú  Ôπå  Ôπã';
      for(let i=0;i<30;i++){
        const s=document.createElement('span');
        s.textContent=glyphs[Math.floor(Math.random()*glyphs.length)];
        s.style.left=(Math.random()*100)+'%';
        s.style.top=(Math.random()*100)+'%';
        s.style.animationDuration=(9+Math.random()*13)+'s';
        s.style.fontSize=(10+Math.random()*8)+'px';
        box.appendChild(s);
      }
    })();

    /* –î–Ω–∏/–≤—Ä–µ–º—è */
    const DAYS=['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞','–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
    const TIMES=['07:00 ‚Äì 10:00','10:00 ‚Äì 13:00','13:00 ‚Äì 16:00','16:00 ‚Äì 19:00','19:00 ‚Äì 23:00','23:00 ‚Äì 06:00'];

    function renderChips(containerId, values, name){
      const box=document.getElementById(containerId); if(!box) return;
      box.innerHTML='';
      values.forEach(v=>{
        const lbl=document.createElement('label'); lbl.className='chip';
        if(containerId==='daysChips' && v==='–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ') lbl.classList.add('sunday');
        lbl.innerHTML = `<input type="checkbox" name="${name}" value="${v}"><span class="toggler"></span><span class="label-inline">${v}</span>`;
        box.appendChild(lbl);
      })
    }
    renderChips('daysChips', DAYS, 'days');
    renderChips('timesChips', TIMES, 'times');

    /* Supabase */
    const SUPABASE_URL = window.SUPABASE_URL;
    const SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY;
    const supabase = (SUPABASE_URL && !SUPABASE_URL.includes('YOUR_')) ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

    /* Submit */
    const form = document.getElementById('regForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const decks = [...form.querySelectorAll('input[name="decks"]:checked')].map(x => x.value);
      const roles = [...form.querySelectorAll('input[name="roles"]:checked')].map(x => x.value);
      const days  = [...form.querySelectorAll('input[name="days"]:checked')].map(x => x.value);
      const times = [...form.querySelectorAll('input[name="times"]:checked')].map(x => x.value);

      const payload = {
        clan: '–§–µ–Ω–∏–∫—Å',
        nickname: form.nickname.value.trim(),
        telegram: form.telegram.value.trim(),
        birthdate: form.birthdate.value || null,
        country: form.country.value.trim() || null,
        city: form.city.value.trim() || null,
        days, times,
        expectations: form.expect?.value.trim() || null,
        experience: form.experience.value || null,
        partners: form.partners?.value.trim() || null,
        conflicts: form.conflicts?.value.trim() || null,
        decks,
        roles,
        play_other: document.getElementById('play_other')?.checked || false,
        clan_life: document.getElementById('clan_life')?.checked || false,
        created_at: new Date().toISOString()
      };

      try {
        if(supabase){
          const { error: e1 } = await supabase.from('rg_players').insert(payload);
          if(e1) throw e1;
          const { error: e2 } = await supabase.from('rg_consents').insert({
            notify_ok: document.getElementById('notify_ok').checked,
            rules_ok: document.getElementById('rules_ok').checked
          });
          if(e2) console.warn('Consent insert warning:', e2.message);
        }
        alert('–°–ø–∞—Å–∏–±–æ! –ê–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.');
      } catch (err) {
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Å—å —Å –∞–¥–º–∏–Ω–æ–º.');
        console.error(err);
      }
    });

    /* –ê–¥–º–∏–Ω-–ø—Ä–æ—Å–º–æ—Ç—Ä (?admin=1) */
    (async function(){
      const params = new URLSearchParams(location.search);
      if(params.get('admin') !== '1') return;
      const adminEl = document.getElementById('admin'); adminEl.style.display='block';
      if(!supabase){ document.getElementById('grid').innerHTML = '<p style="color:var(--muted)">–£–∫–∞–∂–∏ SUPABASE_URL –∏ SUPABASE_ANON_KEY.</p>'; return; }

      const grid = document.getElementById('grid');
      const search = document.getElementById('search');
      const reload = document.getElementById('reload');

      async function load(){
        const term = (search.value||'').trim().toLowerCase();
        const { data, error } = await supabase
          .from('rg_players')
          .select('*')
          .order('created_at',{ascending:false})
          .limit(500);
        if(error){ grid.textContent = error.message; return; }
        const rows = term
          ? data.filter(r => (r.nickname||'').toLowerCase().includes(term) || (r.telegram||'').toLowerCase().includes(term))
          : data;
        render(rows);
      }

      function pill(list){ return Array.isArray(list)&&list.length? list.join(', ') : '‚Äî'; }

      function render(rows){
        if(!rows || !rows.length){ grid.innerHTML = '<p style="color:var(--muted); margin:6px">–ü–æ–∫–∞ –ø—É—Å—Ç–æ.</p>'; return; }
        const html = [`<table style="width:100%; border-collapse:separate; border-spacing:0 6px; font-size:14px">`,
          `<thead><tr>`+
            `<th style="text-align:left; padding:6px 8px">–ù–∏–∫</th>`+
            `<th style="text-align:left; padding:6px 8px">TG</th>`+
            `<th style="text-align:left; padding:6px 8px">–ì–æ—Ä–æ–¥</th>`+
            `<th style="text-align:left; padding:6px 8px">–û–ø—ã—Ç</th>`+
            `<th style="text-align:left; padding:6px 8px">–î–Ω–∏</th>`+
            `<th style="text-align:left; padding:6px 8px">–í—Ä–µ–º—è</th>`+
            `<th style="text-align:left; padding:6px 8px">–†–æ–ª–∏</th>`+
            `<th style="text-align:left; padding:6px 8px">–ö–æ–ª–æ–¥—ã</th>`+
            `<th style="text-align:left; padding:6px 8px">–°–æ–∑–¥–∞–Ω–æ</th>`+
          `</tr></thead><tbody>`];
        rows.forEach(r=>{
          html.push(`<tr>`+
            `<td style="background:#141a22; padding:8px 10px; border-radius:10px 0 0 10px">${r.nickname||''}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${r.telegram||''}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${[r.city,r.country].filter(Boolean).join(', ')}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${r.experience||''}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${pill(r.days)}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${pill(r.times)}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${pill(r.roles)}</td>`+
            `<td style="background:#141a22; padding:8px 10px">${pill(r.decks)}</td>`+
            `<td style="background:#141a22; padding:8px 10px; border-radius:0 10px 10px 0">${new Date(r.created_at).toLocaleString()}</td>`+
          `</tr>`);
        });
        html.push(`</tbody></table>`);
        grid.innerHTML = html.join('');
      }

      reload.addEventListener('click', load);
      search.addEventListener('input', load);
      load();
    })();

    /* –ö–æ—Ä–æ—Ç–∫–∏–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (?test=1) */
    (function(){
      const params = new URLSearchParams(location.search);
      if(params.get('test') !== '1') return;
      const results = [];
      try{ results.push(['canvas-exists', !!document.getElementById('embers')]); }catch(e){ results.push(['canvas-exists', false, e.message]); }
      try{ results.push(['days-fullnames-7', document.querySelectorAll('#daysChips .chip').length === 7]); }catch(e){ results.push(['days-fullnames-7', false, e.message]); }
      try{ results.push(['times-6', document.querySelectorAll('#timesChips .chip').length === 6]); }catch(e){ results.push(['times-6', false, e.message]); }
      console.table(results.map(([name, ok])=>({test:name, ok})));
    })();

  })();
  </script>
</body>
</html>
